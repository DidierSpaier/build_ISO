#!/bin/sh
# shellcheck disable=SC1090
[ "$#" -ne 1 ] && echo "usage: $0 [salix|slackware|slint]" && exit
distribution="$1"
if [ ! "$distribution" = salix ] && [ ! "$distribution" = slackware ] && [ ! "$distribution" = slint ]; then
	echo "$distribution= is not a supported distribution"
	exit
fi
. .set_variables_"$distribution"
# Run this script as regular user
rm -f "$ROOTDIR"/doc/*html
cd "$SLINTDOCS/translations/HandBook" || exit
cp "$SLINTDOCS/sources/HandBook/HandBook.adoc" en_US.HandBook.adoc || exit
for handbook in *.HandBook.adoc; do
	ll_TT="${handbook%.*.*}"
	echo "$ll_TT ..."
	sleep 1
	{
	echo \
":toc: left
:toclevels: 1
:toc-title: 
" >> "${ll_TT}".adoc
	# Chapter Overview of Slint installation
	sed -n '\@// Overview@,\@// Usage@p' "$handbook"|head -n -1
	# Chapter Usage of the installer
	sed -n "\@// Usage_installer@,\@// Encryption@p" "$handbook"|head -n -1
	# Chapter Prepare partitions for Slnt
	sed -n '\@// Prepare@,\@// Installation@p' "$handbook"
	# Chapter Encryption
	sed -n "\@// Encryption@,\@// Speakup@p" "$handbook"|head -n -1
	# Chapter Speakup
	sed -n "\@// Speakup@,\@// First_steps@p" "$handbook"| head -n -1
	# Chapter first steps
	sed -n "\@// First_steps@,\@// Usage@p" "$handbook"|head -n -1
	sed -n '\@// Glossary@,$p' "$handbook"
	} >> "${ll_TT}".adoc
	# Chapter Glossary.
	# Normalize the headers' levels not the same in the installer doc as in the HandBook
	sed 's/^== /==== /' "${ll_TT}".adoc > bof && mv bof "${ll_TT}".adoc
	sed 's/^===== /=== /' "${ll_TT}".adoc > bof && mv bof "${ll_TT}".adoc
	sed 's/^==== /== /' "${ll_TT}".adoc > bof && mv bof "${ll_TT}".adoc
	asciidoctor "${ll_TT}".adoc
	mv "${ll_TT}".html "$ROOTDIR"/doc || exit
done
cd "$CWD" || exit 1
